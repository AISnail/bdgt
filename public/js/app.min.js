function StackedBarChart(element,label){this.element=element,this.label=label,this.data={labels:[],datasets:[{label:"",backgroundColor:"",data:[]}]}}$(document).on("ready ajaxComplete",function(){$(".moment").not(".processed-ready").each(function(value){var dateFromNow=moment($(this).text(),"YYYY-MM-DD").fromNow();"Invalid date"!==dateFromNow&&$(this).text(dateFromNow),$(this).addClass("processed-ready")}),$(".money").not(".processed-ready").each(function(value){var formattedValue=accounting.formatMoney($(this).text(),"$ ");void 0!==formattedValue&&$(this).text(formattedValue)}),$(".money-signed").not(".processed-ready").each(function(value){"-"==$(this).text().charAt(0)?$(this).addClass("negative"):$(this).addClass("positive")})}),$(document).ready(function(){$(".datepicker").each(function(){var dp=$(this);dp.datepicker({zIndexOffset:1050,format:"yyyy-mm-dd"}),dp.val()||dp.datepicker("setDate",new Date).datepicker("update")})});var Loan=function(amount,interestRate,minimumPayment){this.amount=parseFloat(amount),this.interestRate=parseFloat(interestRate),this.interestRate>1&&(this.interestRate/=100),this.minimumPayment=parseFloat(minimumPayment),this.payment=this.minimumPayment};Loan.prototype.makePayment=function(amount){return this.payment=amount,this.calculate()},Loan.prototype.getPrincipal=function(){return void 0===this.amount||NaN===this.amount?0:this.amount},Loan.prototype.calculate=function(){for(var i=0,principal=this.getPrincipal(),interestPaid=0,date=moment(),currentBalance=principal;currentBalance>0;)if(date.add(1,"M"),currentBalance-=this.payment,currentBalance*=1+this.interestRate,interestPaid+=currentBalance*this.interestRate,i>960||currentBalance>=1/0)return{interest:-1};return{date:date,interest:interestPaid}},Loan.prototype.formatWithCommas=function(num){return num.toString().replace(/(\.\d{2})\d+$/,"$1").replace(/(?=(\d{3})+(?!\d))/g,",")},StackedBarChart.prototype.initializeChart=function(){return this.chart=new Chart(this.element,{type:"bar",data:this.data,options:{title:{display:!0,text:this.label},tooltips:{mode:"label",callbacks:{label:function(tooltipItems,data){return data.datasets[tooltipItems.datasetIndex].label+": $"+tooltipItems.yLabel.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}},responsive:!0,scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0,ticks:{callback:function(label){return"$"+label.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}}]}}}),this},StackedBarChart.prototype.updateData=function(data){var self=this;self.data=data;var colors=self.getSemiRandomColors();$.each(self.data.datasets,function(i,dataset){var randColor=Math.floor(Math.random()*colors.length);dataset.backgroundColor=colors[randColor],colors.splice(randColor,1)})},StackedBarChart.prototype.redraw=function(){void 0!==this.chart&&this.chart.clear(),this.initializeChart()},StackedBarChart.prototype.getSemiRandomColors=function(){return["#4D4D4D","#5DA5DA","#FAA43A","#60BD68","#F17CB0","#B2912F","#B276B2","#DECF3F","#F15854"]},StackedBarChart.prototype.randomColor=function(){return Math.round(255*Math.random())},window.onload=function(){var reportName=$("#bdgtReport").data("name"),reportUrl=$("#bdgtReport").data("url");void 0!==reportUrl&&(window.bdgtReport=new StackedBarChart($("#bdgtReport"),reportName),$.getJSON(reportUrl,function(json){window.bdgtReport.updateData(json),window.bdgtReport.redraw()}))};